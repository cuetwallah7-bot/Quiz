<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Test - Quiz Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f8f9fa;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .logo {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .test-info {
            color: white;
            text-align: center;
        }

        .test-timer {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        .test-header {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .test-header h1 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .test-header p {
            color: #666;
        }

        .question-container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
            color: #333;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option {
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .question-palette {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .palette-title {
            font-weight: bold;
            margin-bottom: 1rem;
            color: #333;
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 0.5rem;
        }

        .palette-item {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .palette-item.current {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .palette-item.answered {
            border-color: #2ecc71;
            background: #2ecc71;
            color: white;
        }

        .palette-item.review {
            border-color: #f39c12;
            background: #f39c12;
            color: white;
        }

        .instructions {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .instructions h3 {
            color: #333;
            margin-bottom: 1rem;
        }

        .instructions ul {
            list-style-position: inside;
            color: #666;
            line-height: 1.6;
        }

        .instructions li {
            margin-bottom: 0.5rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .modal h2 {
            color: #333;
            margin-bottom: 1rem;
        }

        .modal p {
            color: #666;
            margin-bottom: 2rem;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .navigation {
                flex-direction: column;
                gap: 1rem;
            }
            
            .btn {
                width: 100%;
            }
            
            .palette-grid {
                grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            }
            
            .palette-item {
                width: 40px;
                height: 40px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">QuizMaster</div>
        <div class="test-info">
            <div>Demo Test - General Knowledge</div>
            <div class="test-timer" id="timer">03:00:00</div>
        </div>
    </nav>

    <div class="container">
        <div class="instructions">
            <h3>Instructions</h3>
            <ul>
                <li>Total Questions: 5 (Demo)</li>
                <li>Time Allotted: 3 hours</li>
                <li>Each question carries equal marks</li>
                <li>No negative marking in this demo</li>
                <li>Click on the option to select your answer</li>
            </ul>
        </div>

        <div class="question-palette">
            <div class="palette-title">Question Palette</div>
            <div class="palette-grid" id="questionPalette"></div>
        </div>

        <div class="test-header">
            <h1>Demo Knowledge Test</h1>
            <p>Answer all questions to the best of your ability</p>
        </div>

        <div class="question-container">
            <div class="question-number" id="questionNumber">Question 1 of 5</div>
            <div class="question-text" id="questionText"></div>
            
            <div class="options-container" id="optionsContainer"></div>
            
            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()">Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Next</button>
                <button class="btn btn-success" id="submitBtn" onclick="showSubmitModal()" style="display: none;">Submit Test</button>
            </div>
        </div>
    </div>

    <!-- Submit Confirmation Modal -->
    <div class="modal" id="submitModal">
        <div class="modal-content">
            <h2>Submit Test?</h2>
            <p>Are you sure you want to submit the test? You still have <span id="timeRemaining">some time</span> left.</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="hideSubmitModal()">Cancel</button>
                <button class="btn btn-success" onclick="submitTest()">Submit Test</button>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal" id="resultsModal">
        <div class="modal-content">
            <h2>Test Submitted Successfully!</h2>
            <div id="resultsContent" style="text-align: left; margin-bottom: 2rem;">
                <!-- Results will be displayed here -->
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="viewDetailedResults()">View Detailed Results</button>
                <button class="btn btn-secondary" onclick="goToDashboard()">Back to Dashboard</button>
            </div>
        </div>
    </div>

    <script>
        let currentQuestion = 0;
        let answers = {};
        let timeLeft = 3 * 60 * 60; // 3 hours in seconds
        let timerInterval;
        let userData = null;

        // Demo questions
        const questions = [
            {
                question: "What is the capital of France?",
                options: ["London", "Berlin", "Paris", "Madrid"],
                correct: 2
            },
            {
                question: "Which planet is known as the Red Planet?",
                options: ["Venus", "Mars", "Jupiter", "Saturn"],
                correct: 1
            },
            {
                question: "What is the largest mammal in the world?",
                options: ["Elephant", "Blue Whale", "Giraffe", "Polar Bear"],
                correct: 1
            },
            {
                question: "Who wrote 'Romeo and Juliet'?",
                options: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"],
                correct: 1
            },
            {
                question: "What is the chemical symbol for gold?",
                options: ["Go", "Gd", "Au", "Ag"],
                correct: 2
            }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in or demo
            const storedUserData = localStorage.getItem('userData');
            if (!storedUserData) {
                window.location.href = 'login.html';
                return;
            }

            userData = JSON.parse(storedUserData);
            initializeTest();
        });

        function initializeTest() {
            createQuestionPalette();
            showQuestion(0);
            startTimer();
        }

        function createQuestionPalette() {
            const palette = document.getElementById('questionPalette');
            palette.innerHTML = '';

            questions.forEach((_, index) => {
                const item = document.createElement('div');
                item.className = 'palette-item';
                item.textContent = index + 1;
                item.onclick = () => showQuestion(index);
                
                palette.appendChild(item);
            });
        }

        function showQuestion(index) {
            currentQuestion = index;
            const question = questions[index];
            
            // Update question number
            document.getElementById('questionNumber').textContent = `Question ${index + 1} of ${questions.length}`;
            
            // Update question text
            document.getElementById('questionText').textContent = question.question;
            
            // Update options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, optIndex) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = `option ${answers[index] === optIndex ? 'selected' : ''}`;
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(optIndex);
                optionsContainer.appendChild(optionDiv);
            });
            
            // Update navigation buttons
            document.getElementById('prevBtn').style.display = index === 0 ? 'none' : 'block';
            document.getElementById('nextBtn').style.display = index === questions.length - 1 ? 'none' : 'block';
            document.getElementById('submitBtn').style.display = index === questions.length - 1 ? 'block' : 'none';
            
            // Update palette
            updatePalette();
        }

        function selectOption(optionIndex) {
            answers[currentQuestion] = optionIndex;
            showQuestion(currentQuestion); // Refresh to show selection
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            }
        }

        function updatePalette() {
            const paletteItems = document.querySelectorAll('.palette-item');
            paletteItems.forEach((item, index) => {
                item.className = 'palette-item';
                if (index === currentQuestion) {
                    item.classList.add('current');
                }
                if (answers[index] !== undefined) {
                    item.classList.add('answered');
                }
            });
        }

        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitTest();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const hours = Math.floor(timeLeft / 3600);
            const minutes = Math.floor((timeLeft % 3600) / 60);
            const seconds = timeLeft % 60;
            
            document.getElementById('timer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function showSubmitModal() {
            const unanswered = questions.length - Object.keys(answers).length;
            document.getElementById('timeRemaining').textContent = document.getElementById('timer').textContent;
            document.getElementById('submitModal').style.display = 'flex';
        }

        function hideSubmitModal() {
            document.getElementById('submitModal').style.display = 'none';
        }

        function submitTest() {
            clearInterval(timerInterval);
            hideSubmitModal();
            
            // Calculate results
            let score = 0;
            let correctAnswers = 0;
            let wrongAnswers = 0;
            let attempted = Object.keys(answers).length;
            
            questions.forEach((question, index) => {
                if (answers[index] !== undefined) {
                    if (answers[index] === question.correct) {
                        score += 4;
                        correctAnswers++;
                    } else {
                        wrongAnswers++;
                    }
                }
            });

            const resultData = {
                UserID: userData.UserID,
                TestID: 'DEMO_TEST',
                Score: score,
                TotalMarks: questions.length * 4,
                CorrectAnswers: correctAnswers,
                WrongAnswers: wrongAnswers,
                Attempted: attempted,
                DetailedAnalysis: {
                    subjectWise: {
                        'General Knowledge': {
                            correct: correctAnswers,
                            wrong: wrongAnswers,
                            attempted: attempted,
                            total: questions.length
                        }
                    },
                    timeManagement: {
                        totalTime: 3 * 60 * 60,
                        timeSpent: (3 * 60 * 60) - timeLeft
                    }
                }
            };

            // Save results
            google.script.run
                .withSuccessHandler(showResults)
                .withFailureHandler(handleSubmitError)
                .saveTestResults(resultData);
        }

        function showResults(response) {
            if (response.success) {
                const resultsContent = document.getElementById('resultsContent');
                
                let html = `
                    <div style="margin-bottom: 1rem;">
                        <strong>Score:</strong> ${response.rank ? response.rank : 'Calculating...'}
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>Marks Obtained:</strong> ${response.score || 0}
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>Correct Answers:</strong> ${response.correctAnswers || 0}
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>Wrong Answers:</strong> ${response.wrongAnswers || 0}
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>Attempted:</strong> ${response.attempted || 0}/${questions.length}
                    </div>
                `;
                
                resultsContent.innerHTML = html;
                document.getElementById('resultsModal').style.display = 'flex';
            } else {
                alert('Error submitting test: ' + response.message);
            }
        }

        function handleSubmitError(error) {
            alert('Error submitting test. Please try again.');
            console.error(error);
        }

        function viewDetailedResults() {
            // In a real scenario, this would show detailed analysis
            alert('Detailed results would be shown here with subject-wise breakdown and analytics.');
        }

        function goToDashboard() {
            window.location.href = 'dashboard.html';
        }
    </script>
</body>
</html>